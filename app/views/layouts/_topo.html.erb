<div class="fixed top-0 left-0 right-0 bg-white shadow-md z-50">
  <div class="container mx-auto px-4">
    <div class="flex justify-between items-center h-16">

      <!-- Bot√£o Mobile -->
      <button class="md:hidden p-2" data-action="click->navbar#toggle" aria-label="Menu" aria-expanded="false">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      <!-- Logo -->
      <div class="flex-shrink-0">
        <%= link_to root_url, aria: { label: "P√°gina inicial" } do %>
        <%= image_tag("escudo_mini.png", class: "w-12 h-12 block", alt: "Logo do site") %>
        <% end %>
      </div>

      <!-- Menu Principal Desktop -->
      <nav class="hidden md:flex space-x-1">
        <ul class="flex items-center space-x-1">
          <li class="<%= 'bg-gray-100' if controller_name == 'home' && action_name == 'index' %>">
            <%= link_to root_url, class: "px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 flex items-center" do %>
              <span class="mr-1" aria-hidden="true">üè†</span> In√≠cio
            <% end %>
          </li>

          <% if @bolao_atual %>
            <li class="relative group <%= 'bg-gray-100' if controller_name == 'eventos' && action_name == 'index' %>">
              <%= link_to @bolao_atual, class: "px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 flex items-center" do %>
                <span class="mr-1" aria-hidden="true">üèÜ</span> <%= @bolao_atual.titulo.upcase.split(' ')[0,2].join(' ') %>
              <% end %>
              
              <!-- Submenu Bol√µes -->
              <div class="absolute left-0 mt-0 w-48 bg-white rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                <%= link_to '√öltima Rodada', [@bolao_atual, @rodada_atual], class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
                <%= link_to 'Rodadas', bolao_rodadas_path(@bolao_atual), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
                <%= link_to 'Todos Bol√µes', bolaos_path, class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
              </div>
            </li>
          <% else %>
            <li class="<%= 'bg-gray-100' if controller_name == 'eventos' && action_name == 'index' %>">
              <%= link_to bolaos_path, class: "px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 flex items-center" do %>
                <span class="mr-1" aria-hidden="true">üèÜ</span> Todos Bol√µes
              <% end %>
            </li>
          <% end %>

          <li class="<%= 'bg-gray-100' if controller_name == 'posts' && action_name == 'index' %>">
            <%= link_to posts_path, class: "px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 flex items-center" do %>
              <span class="mr-1" aria-hidden="true">üíª</span> Blog
            <% end %>
          </li>

          <li class="<%= 'bg-gray-100' if controller_name == 'albums' && action_name == 'index' %>">
            <%= link_to albums_path, class: "px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 flex items-center" do %>
              <span class="mr-1" aria-hidden="true">üì∑</span> Fotos
            <% end %>
          </li>

          <% if user_signed_in? %>
            <li>
              <%= link_to "/regulamentoSCA.pdf", target: "_blank", rel: "noopener noreferrer", class: "px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 flex items-center" do %>
                <span class="mr-1" aria-hidden="true">üìñ</span> Regulamento
              <% end %>
            </li>
            <li class="<%= 'bg-gray-100' if controller_name == 'contatos' && action_name == 'new' %>">
              <%= link_to new_contato_path, class: "px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 flex items-center" do %>
                <span class="mr-1" aria-hidden="true">‚úâÔ∏è</span> Contato
              <% end %>
            </li>
          <% end %>
        </ul>
      </nav>

      <!-- √Årea do Usu√°rio -->
      <div class="flex items-center space-x-4">
        <% if user_signed_in? %>
          <!-- Menu Admin (se aplic√°vel) -->
          <% if admin? %>
            <%= render 'users/admin_menu' %>
          <% end %>

          <!-- Menu do Usu√°rio -->
          <div class="relative group">
            <button class="flex items-center space-x-2 focus:outline-none">
              <div class="w-8 h-8 rounded-full overflow-hidden bg-gray-200">
                <%= image_tag(current_user.avatar? ? current_user.avatar.thumb.url : no_image_url) -%>
              </div>
              <span class="text-sm font-medium">Perfil</span>
            </button>
            <div class="absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
              <%= render 'users/nav_dropmenu' %>
            </div>
          </div>
        <% else %>
          <!-- Login e Solicita√ß√£o de Cadastro -->
          <%= link_to "Entrar", new_user_session_path, class: "px-3 py-2 text-sm font-medium hover:bg-gray-100 rounded-md" %>
          <%= link_to "Solicitar Cadastro", new_contato_path(request: true), class: "px-3 py-2 text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 rounded-md" %>
        <% end %>
      </div>

      <!-- Menu Mobile -->
      <div class="md:hidden absolute top-16 left-0 right-0 bg-white shadow-md z-40 hidden" id="mobile-menu">
        <ul class="py-2">
          <li>
            <%= link_to root_url, class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" do %>
              <span class="mr-1" aria-hidden="true">üè†</span> In√≠cio
            <% end %>
          </li>

          <% if @bolao_atual %>
            <li>
              <%= link_to @bolao_atual, class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" do %>
                <span class="mr-1" aria-hidden="true">üèÜ</span> <%= @bolao_atual.titulo.upcase.split(' ')[0,2].join(' ') %>
              <% end %>
            </li>
            <li>
              <%= link_to '√öltima Rodada', [@bolao_atual, @rodada_atual], class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100 pl-8" %>
            </li>
            <li>
              <%= link_to 'Rodadas', bolao_rodadas_path(@bolao_atual), class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100 pl-8" %>
            </li>
            <li>
              <%= link_to 'Todos Bol√µes', bolaos_path, class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100 pl-8" %>
            </li>
          <% else %>
            <li>
              <%= link_to 'Todos Bol√µes', bolaos_path, class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" %>
            </li>
          <% end %>

          <li>
            <%= link_to 'Blog', posts_path, class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" %>
          </li>
          <li>
            <%= link_to 'Fotos', albums_path, class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" %>
          </li>

          <% if user_signed_in? %>
            <li>
              <%= link_to 'Regulamento', "/regulamentoSCA.pdf", target: "_blank", class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" %>
            </li>
            <li>
              <%= link_to 'Contato', new_contato_path, class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" %>
            </li>
          <% end %>

          <% if user_signed_in? %>
            <% if admin? %>
              <li class="border-t border-gray-200">
                <%= render 'users/admin_menu_mobile' %>
              </li>
            <% end %>
            <li class="border-t border-gray-200">
              <%= link_to 'Perfil', users_show_path, class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" %>
            </li>
            <li>
              <%= button_to 'Sair', destroy_user_session_path, method: :delete, class: "w-full text-left block px-4 py-2 text-sm font-medium hover:bg-gray-100 text-red-600" %>
            </li>
          <% else %>
            <li class="border-t border-gray-200">
              <%= link_to 'Entrar', new_user_session_path, class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" %>
            </li>
            <li>
              <%= link_to 'Solicitar Cadastro', new_contato_path(request: true), class: "block px-4 py-2 text-sm font-medium hover:bg-gray-100" %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Banner Topo -->
<div id="topo_cover" class="relative">
  <div class="mt-10 escudo_main flex justify-center items-center py-8">
    <%= image_tag("escudo.png", class: "escudo h-48 w-auto") %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.querySelector('[data-action="click->navbar#toggle"]');
    const mobileMenu = document.getElementById('mobile-menu');

    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', function() {
        mobileMenu.classList.toggle('hidden');
        this.setAttribute('aria-expanded', !mobileMenu.classList.contains('hidden'));
      });
    }
  });
</script>